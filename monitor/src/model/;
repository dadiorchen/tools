//@flow
/* To ping the given server, record the result to file, 
 * for future stat */
import * as fs	from 'fs'

const log		= require('loglevel').getLogger('../model/Monitor.js')

export class Monitor{
	timerStub	: any
	IP			: string
	interval	: 1000
	logFilePath	: string

	/* To config the monitor, like ping interval and so on */
	config(options : {
		IP		: string,
		interval		: number, //ms
		logFilePath		: string,
	}){
		//{{{
		const label		= 'Monitor -> config'
		log.debug('%s:',label)
		//check if the file exist
		const {IP,interval,logFilePath}	= options
		if(!/\d+\.\d+\.\d+\.\d+/.test(IP)){
			throw Error(`invalid IP:${IP}`)
		}
		this.IP		= IP

		if(!/\d+/.test(interval + '')){
			throw Error(`invlalid interval:${interval}`)
		}
		
		if(fs.existsSync(logFilePath)){
			log.debug('%s:OK log file exist',label)
		}else{
			log.debug('%s:log file not exist, create',label)
			fs.appendFileSync(logFilePath,'')
		}
		//}}}
	}

	/* To start the monitor */
	start(){
		//{{{
		const label		= 'Monitor -> start'
		log.debug('%s:',label)
		this.timerStub	= setTimeinteval(this.beat,this.interval)

		//}}}
	}

	/* To stop the monitor */
	stop(){
	}
}
